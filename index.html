<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø°ÙƒÙŠØ©: Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ù…Ø¯Ù†ÙŠ v3.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0f172a;
            --accent: #ca8a04;
            --bg: #f8fafc;
            --white: #ffffff;
            --text: #334155;
            --success: #15803d;
            --error: #b91c1c;
            --border: #e2e8f0;
        }

        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; }
        body { margin: 0; background-color: var(--bg); color: var(--text); padding-bottom: 80px; }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary), #334155);
            color: var(--white);
            padding: 30px 20px 70px;
            text-align: center;
            border-bottom-left-radius: 40px;
            border-bottom-right-radius: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .app-title { font-size: 2.2rem; font-weight: 900; margin: 0; color: var(--accent); }
        .countdown-box { display: flex; justify-content: center; gap: 10px; margin-top: 20px; }
        .time-unit { background: rgba(255,255,255,0.15); padding: 8px 15px; border-radius: 12px; min-width: 70px; backdrop-filter: blur(5px); }
        .time-val { font-size: 1.4rem; font-weight: 700; display: block; }
        .time-lbl { font-size: 0.75rem; opacity: 0.9; }

        /* Layout */
        .container { max-width: 900px; margin: -50px auto 0; padding: 0 20px; position: relative; z-index: 10; }

        /* Cards */
        .card { background: var(--white); border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 20px; border: 1px solid var(--border); overflow: hidden; }
        
        /* Controls */
        .controls { padding: 20px; display: flex; gap: 10px; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 10px; font-weight: 700; cursor: pointer; transition: 0.2s; font-size: 1rem; }
        .btn-outline { background: transparent; border: 2px solid var(--border); color: var(--text); }
        .btn-outline.active { background: var(--primary); color: var(--white); border-color: var(--primary); }
        .btn-action { background: var(--accent); color: var(--white); }
        .btn-action:hover { background: #b45309; }

        /* Review Mode */
        .search-box { width: 100%; padding: 15px; border: 2px solid var(--border); border-radius: 12px; font-size: 1rem; margin-bottom: 20px; }
        .q-item { border-bottom: 1px solid var(--border); }
        .q-head { padding: 15px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; font-weight: 600; }
        .q-head:hover { background: #f1f5f9; }
        .q-body { max-height: 0; overflow: hidden; transition: max-height 0.3s; background: #f8fafc; padding: 0 20px; color: #475569; }
        .q-item.open .q-body { padding: 15px 20px; max-height: 500px; border-top: 1px solid var(--border); }

        /* Exam Mode */
        .exam-area { display: none; text-align: center; }
        .exam-header { display: flex; justify-content: space-between; margin-bottom: 20px; font-weight: bold; background: #e2e8f0; padding: 10px 20px; border-radius: 10px; }
        .question-text { font-size: 1.3rem; margin: 30px 0; color: var(--primary); line-height: 1.6; }
        
        .options-grid { display: flex; gap: 15px; justify-content: center; margin-bottom: 20px; }
        .opt-btn { padding: 15px 40px; border-radius: 12px; border: 2px solid var(--border); background: white; font-size: 1.1rem; cursor: pointer; font-weight: bold; }
        .opt-btn:hover { background: #f1f5f9; }
        .opt-btn.correct { background: #dcfce7; border-color: var(--success); color: var(--success); }
        .opt-btn.wrong { background: #fee2e2; border-color: var(--error); color: var(--error); }

        .feedback { display: none; padding: 15px; border-radius: 10px; margin-top: 15px; text-align: right; }
        .feedback.success { background: #dcfce7; color: #14532d; }
        .feedback.error { background: #fee2e2; color: #7f1d1d; }

        /* Results & Analytics */
        .result-box { display: none; text-align: center; padding: 40px 20px; }
        .score-circle { width: 120px; height: 120px; background: var(--primary); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; font-weight: 900; margin: 0 auto 20px; }
        
        .analytics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 30px; text-align: right; }
        .stat-card { background: #f1f5f9; padding: 15px; border-radius: 10px; border-right: 4px solid var(--accent); }
        .stat-label { font-size: 0.85rem; color: #64748b; }
        .stat-val { font-weight: bold; font-size: 1.1rem; color: var(--primary); }

        /* Categories Tags */
        .cat-tag { font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; background: #e2e8f0; color: #64748b; margin-left: 5px; }

    </style>
</head>
<body>

    <header>
        <h1 class="app-title">Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„Ø°ÙƒÙŠØ©: Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ù…Ø¯Ù†ÙŠ</h1>
        <div class="countdown-box" id="countdown"></div>
        <div style="margin-top:10px; font-size:0.9rem; opacity:0.8">Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†: 11-01-2026</div>
    </header>

    <div class="container">
        
        <div class="card controls">
            <button class="btn btn-outline active" id="btnReview" onclick="setMode('review')">ğŸ“– Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©</button>
            <button class="btn btn-outline" id="btnExam" onclick="setMode('exam')">ğŸ“ Ø§Ù…ØªØ­Ø§Ù† Ø°ÙƒÙŠ</button>
        </div>

        <div id="reviewSection">
            <input type="text" class="search-box" id="searchInput" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…ÙØ§Ù‡ÙŠÙ… (Ø§Ù„ØºÙ„Ø·ØŒ Ø§Ù„ØªØ¯Ù„ÙŠØ³ØŒ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©)...">
            <div class="card" id="questionsContainer">
                </div>
        </div>

        <div id="examSection" class="exam-area">
            
            <div id="examStart" class="card" style="padding: 40px;">
                <h2>Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±ØŸ</h2>
                <p style="color:#64748b; margin-bottom:20px;">Ø§Ù„Ù†Ø¸Ø§Ù… Ø³ÙŠØ®ØªØ§Ø± 15 Ø³Ø¤Ø§Ù„Ø§Ù‹ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ§Ù‹ ÙˆÙŠØ­Ù„Ù„ Ù†Ù‚Ø§Ø· Ø¶Ø¹ÙÙƒ.</p>
                <button class="btn btn-action" onclick="examEngine.start()">Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ø¢Ù†</button>
            </div>

            <div id="examActive" class="card" style="padding: 20px; display:none;">
                <div class="exam-header">
                    <span id="qProgress">1 / 15</span>
                    <span id="timer" style="color:var(--error)">00:00</span>
                </div>
                
                <div id="qCategory" style="text-align:right; font-size:0.8rem; color:#94a3b8;"></div>
                <div class="question-text" id="qText">...</div>

                <div class="options-grid" id="optionsBox">
                    <button class="opt-btn" onclick="examEngine.answer(true)">âœ… ØµØ­ÙŠØ­</button>
                    <button class="opt-btn" onclick="examEngine.answer(false)">âŒ Ø®Ø·Ø£</button>
                </div>

                <div id="feedbackBox" class="feedback"></div>
                <button id="nextBtn" class="btn btn-action" style="width:100%; display:none; margin-top:15px;" onclick="examEngine.next()">Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ</button>
            </div>

            <div id="examResult" class="card result-box">
                <div class="score-circle" id="finalScore">0%</div>
                <h2>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„</h2>
                <p id="finalMsg" style="color:#64748b;"></p>
                
                <div class="analytics-grid" id="analyticsBox">
                    </div>

                <button class="btn btn-outline" style="margin-top:30px; width:100%;" onclick="location.reload()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
            </div>

        </div>

    </div>

    <script>
        // ==========================================
        // 1. DATA LAYER (Refactored & Structured)
        // ==========================================
        const categories = {
            consent: "Ø§Ù„ØªØ±Ø§Ø¶ÙŠ ÙˆØ§Ù„Ø¹Ù‚Ø¯",
            vices: "Ø¹ÙŠÙˆØ¨ Ø§Ù„Ø¥Ø±Ø§Ø¯Ø©",
            pillars: "Ø§Ù„Ù…Ø­Ù„ ÙˆØ§Ù„Ø³Ø¨Ø¨",
            effects: "Ø¢Ø«Ø§Ø± Ø§Ù„Ø¹Ù‚Ø¯ ÙˆØ§Ù„ÙØ³Ø®",
            tort: "Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø§Ù„ØªÙ‚ØµÙŠØ±ÙŠØ©"
        };

        const db = [
            // --- Consent & Contract ---
            { 
                cat: 'consent', 
                q: 'ÙŠØ³Ù‚Ø· Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ Ø¨ÙˆÙØ§Ø© Ø§Ù„Ù…ÙˆØ¬Ø¨ Ø­ØªÙ‰ Ù„Ùˆ Ø§ØªØµÙ„ Ø¨Ø¹Ù„Ù… Ø§Ù„Ù‚Ø§Ø¨Ù„.', 
                isCorrect: false, 
                expl: 'ÙŠØ³Ù‚Ø· Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ Ø¨ÙˆÙØ§Ø© Ø§Ù„Ù…ÙˆØ¬Ø¨ ÙÙ‚Ø· Ø¥Ø°Ø§ Ø­Ø¯Ø«Øª Ø§Ù„ÙˆÙØ§Ø© Ù‚Ø¨Ù„ Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ Ø¨Ø¹Ù„Ù… Ø§Ù„Ù‚Ø§Ø¨Ù„ (Ø§Ù„Ù…Ø§Ø¯Ø© 62).', 
                ref: 'ØµÙØ­Ø© 2' 
            },
            { 
                cat: 'consent', 
                q: 'Ø§Ù„Ø³ÙƒÙˆØª ÙŠØ¹ØªØ¨Ø± Ù‚Ø¨ÙˆÙ„Ø§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø·Ø¨ÙŠØ¹Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø© Ø£Ùˆ Ø§Ù„Ø¹Ø±Ù Ø§Ù„ØªØ¬Ø§Ø±ÙŠ ØªØ¯Ù„ Ø¹Ù„Ù‰ Ø°Ù„Ùƒ.', 
                isCorrect: true, 
                expl: 'Ù†Ø¹Ù…ØŒ Ù‡Ø°Ø§ ÙŠØ³Ù…Ù‰ Ø§Ù„Ø³ÙƒÙˆØª Ø§Ù„Ù…Ù„Ø§Ø¨Ø³ ÙˆÙ‡Ùˆ Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ù…Ù† Ø£ØµÙ„ Ø£Ù† Ø§Ù„Ø³ÙƒÙˆØª Ù„Ø§ ÙŠÙ†Ø³Ø¨ Ù„Ø³Ø§ÙƒØª Ù‚ÙˆÙ„ (Ø§Ù„Ù…Ø§Ø¯Ø© 68).', 
                ref: 'ØµÙØ­Ø© 4' 
            },
            { 
                cat: 'consent', 
                q: 'ÙÙŠ Ø§Ù„ÙˆØ¹Ø¯ Ø¨Ø§Ù„ØªØ¹Ø§Ù‚Ø¯ØŒ Ø¥Ø°Ø§ Ù†ÙƒÙ„ Ø§Ù„ÙˆØ§Ø¹Ø¯ØŒ ÙŠØ¬ÙˆØ² Ù„Ù„Ù…ÙˆØ¹ÙˆØ¯ Ù„Ù‡ Ø§Ø³ØªØµØ¯Ø§Ø± Ø­ÙƒÙ… ÙŠÙ‚ÙˆÙ… Ù…Ù‚Ø§Ù… Ø§Ù„Ø¹Ù‚Ø¯.', 
                isCorrect: true, 
                expl: 'Ø§Ù„Ù…Ø§Ø¯Ø© 72 ØªØ¬ÙŠØ² Ø°Ù„Ùƒ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ù„Ø§Ø²Ù…Ø© Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø¹Ù‚Ø¯ Ù…ØªÙˆØ§ÙØ±Ø©.', 
                ref: 'ØµÙØ­Ø© 6' 
            },

            // --- Vices of Consent ---
            { 
                cat: 'vices', 
                q: 'Ø§Ù„ØºÙ„Ø· ÙÙŠ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ù„Ø§ ÙŠØ¹ÙŠØ¨ Ø§Ù„Ø¥Ø±Ø§Ø¯Ø© ÙˆÙ„Ø§ ÙŠØ¬ÙŠØ² Ø¥Ø¨Ø·Ø§Ù„ Ø§Ù„Ø¹Ù‚Ø¯.', 
                isCorrect: false, 
                expl: 'Ø§Ù„ØºÙ„Ø· ÙÙŠ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† ÙŠØ¹ÙŠØ¨ Ø§Ù„Ø¥Ø±Ø§Ø¯Ø© ÙˆÙŠØ¬ÙŠØ² Ø§Ù„Ø¥Ø¨Ø·Ø§Ù„ Ø¥Ø°Ø§ ØªÙˆØ§ÙØ±Øª ÙÙŠÙ‡ Ø´Ø±ÙˆØ· Ø§Ù„ØºÙ„Ø· ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ (Ø§Ù„Ù…Ø§Ø¯Ø© 83).', 
                ref: 'ØµÙØ­Ø© 10' 
            },
            { 
                cat: 'vices', 
                q: 'ØªØ³Ù‚Ø· Ø¯Ø¹ÙˆÙ‰ Ø§Ù„Ø¥Ø¨Ø·Ø§Ù„ Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø§Ø³ØªØºÙ„Ø§Ù„ Ø¨Ù…Ø±ÙˆØ± 15 Ø³Ù†Ø©.', 
                isCorrect: false, 
                expl: 'Ø§Ù„Ø§Ø³ØªØºÙ„Ø§Ù„ Ù„Ù‡ ØªÙ‚Ø§Ø¯Ù… Ø®Ø§Øµ Ù‚ØµÙŠØ± ÙˆÙ‡Ùˆ Ø³Ù†Ø© ÙˆØ§Ø­Ø¯Ø© Ù…Ù† ØªØ§Ø±ÙŠØ® Ø¥Ø¨Ø±Ø§Ù… Ø§Ù„Ø¹Ù‚Ø¯ (Ø§Ù„Ù…Ø§Ø¯Ø© 90).', 
                ref: 'ØµÙØ­Ø© 20' 
            },
            { 
                cat: 'vices', 
                q: 'Ø§Ù„Ø¥ÙƒØ±Ø§Ù‡ Ø§Ù„Ù…Ø§Ø¯ÙŠ ÙŠØ¹Ø¯Ù… Ø§Ù„Ø¥Ø±Ø§Ø¯Ø©ØŒ Ø¨ÙŠÙ†Ù…Ø§ Ø§Ù„Ø¥ÙƒØ±Ø§Ù‡ Ø§Ù„Ù…Ø¹Ù†ÙˆÙŠ ÙŠØ¹ÙŠØ¨Ù‡Ø§.', 
                isCorrect: true, 
                expl: 'Ø§Ù„Ø¥ÙƒØ±Ø§Ù‡ Ø§Ù„Ù…Ø§Ø¯ÙŠ (ÙƒØ¥Ù…Ø³Ø§Ùƒ Ø§Ù„ÙŠØ¯ Ù„Ù„ØªÙˆÙ‚ÙŠØ¹) ÙŠØ¬Ø¹Ù„ Ø§Ù„Ø¹Ù‚Ø¯ Ø¨Ø§Ø·Ù„Ø§Ù‹ Ø¨Ø·Ù„Ø§Ù†Ø§Ù‹ Ù…Ø·Ù„Ù‚Ø§Ù‹ Ù„Ø§Ù†Ø¹Ø¯Ø§Ù… Ø§Ù„Ø±Ø¶Ø§.', 
                ref: 'ØµÙØ­Ø© 12' 
            },

            // --- Pillars (Object/Cause) ---
            { 
                cat: 'pillars', 
                q: 'Ø§Ù„ØªØ¹Ø§Ù…Ù„ ÙÙŠ ØªØ±ÙƒØ© Ø¥Ù†Ø³Ø§Ù† Ø¹Ù„Ù‰ Ù‚ÙŠØ¯ Ø§Ù„Ø­ÙŠØ§Ø© Ø¬Ø§Ø¦Ø² Ø¥Ø°Ø§ ÙˆØ§ÙÙ‚ Ø§Ù„Ù…ÙˆØ±Ø«.', 
                isCorrect: false, 
                expl: 'Ø¨Ø§Ø·Ù„ Ø¨Ø·Ù„Ø§Ù†Ø§Ù‹ Ù…Ø·Ù„Ù‚Ø§Ù‹ Ù„Ù…Ø®Ø§Ù„ÙØªÙ‡ Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹Ø§Ù…ØŒ ÙˆÙ„Ùˆ Ø¨Ø±Ø¶Ø§ Ø§Ù„Ù…ÙˆØ±Ø« (Ø§Ù„Ù…Ø§Ø¯Ø© 92).', 
                ref: 'ØµÙØ­Ø© 14' 
            },
            { 
                cat: 'pillars', 
                q: 'ÙŠÙØªØ±Ø¶ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† Ø£Ù† Ù„ÙƒÙ„ Ø§Ù„ØªØ²Ø§Ù… Ø³Ø¨Ø¨Ø§Ù‹ Ù…Ø´Ø±ÙˆØ¹Ø§Ù‹ Ù…Ø§ Ù„Ù… ÙŠÙ‚Ù… Ø§Ù„Ø¯Ù„ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¹ÙƒØ³.', 
                isCorrect: true, 
                expl: 'Ø§Ù„Ù…Ø§Ø¯Ø© 98 ØªØ¶Ø¹ Ù‚Ø±ÙŠÙ†Ø© Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø¨Ø³ÙŠØ·Ø© Ø¹Ù„Ù‰ ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø³Ø¨Ø¨ ÙˆÙ…Ø´Ø±ÙˆØ¹ÙŠØªÙ‡.', 
                ref: 'ØµÙØ­Ø© 15' 
            },

            // --- Effects & Dissolution ---
            { 
                cat: 'effects', 
                q: 'ÙÙŠ Ø§Ù„ÙØ³Ø® Ø§Ù„Ø§ØªÙØ§Ù‚ÙŠØŒ ÙŠÙ…Ù„Ùƒ Ø§Ù„Ù‚Ø§Ø¶ÙŠ Ø³Ù„Ø·Ø© Ù…Ù†Ø­ Ù†Ø¸Ø±Ø© Ù…ÙŠØ³Ø±Ø© Ù„Ù„Ù…Ø¯ÙŠÙ†.', 
                isCorrect: false, 
                expl: 'ÙÙŠ Ø§Ù„ÙØ³Ø® Ø§Ù„Ø§ØªÙØ§Ù‚ÙŠ Ø§Ù„ØµØ±ÙŠØ­ØŒ ØªØ³Ù„Ø¨ Ø³Ù„Ø·Ø© Ø§Ù„Ù‚Ø§Ø¶ÙŠ Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ© ÙˆÙŠØ­ÙƒÙ… Ø¨Ø§Ù„ÙØ³Ø® Ø­ØªÙ…Ø§Ù‹.', 
                ref: 'ØµÙØ­Ø© 25' 
            },
            { 
                cat: 'effects', 
                q: 'Ù†Ø¸Ø±ÙŠØ© Ø§Ù„Ø¸Ø±ÙˆÙ Ø§Ù„Ø·Ø§Ø±Ø¦Ø© ØªØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ ÙØ³Ø® Ø§Ù„Ø¹Ù‚Ø¯.', 
                isCorrect: false, 
                expl: 'ØªØ¤Ø¯ÙŠ Ø¥Ù„Ù‰ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø¯ Ø¨Ø±Ø¯ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø§Ù„Ù…Ø±Ù‡Ù‚ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø¹Ù‚ÙˆÙ„ØŒ ÙˆÙ„ÙŠØ³ Ø§Ù„ÙØ³Ø®.', 
                ref: 'ØµÙØ­Ø© 24' 
            },
            { 
                cat: 'effects', 
                q: 'Ø§Ù„Ø¨Ø·Ù„Ø§Ù† Ø§Ù„Ù…Ø·Ù„Ù‚ Ù„Ø§ ØªÙ„Ø­Ù‚Ù‡ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø©.', 
                isCorrect: true, 
                expl: 'Ù„Ø£Ù†Ù‡ Ø¹Ù‚Ø¯ Ù…Ø¹Ø¯ÙˆÙ…ØŒ ÙˆØ§Ù„Ø¥Ø¬Ø§Ø²Ø© ØªØ±Ø¯ ÙÙ‚Ø· Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù‚Ø¯ Ø§Ù„Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø¥Ø¨Ø·Ø§Ù„ (Ø§Ù„Ø¨Ø·Ù„Ø§Ù† Ø§Ù„Ù†Ø³Ø¨ÙŠ).', 
                ref: 'ØµÙØ­Ø© 18' 
            },

            // --- Tort Liability ---
            { 
                cat: 'tort', 
                q: 'Ø³Ù† Ø§Ù„ØªÙ…ÙŠÙŠØ² ÙÙŠ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø§Ù„ØªÙ‚ØµÙŠØ±ÙŠØ© Ù‡Ùˆ 19 Ø³Ù†Ø©.', 
                isCorrect: false, 
                expl: 'Ø³Ù† Ø§Ù„ØªÙ…ÙŠÙŠØ² (Ø§Ù„Ø¥Ø¯Ø±Ø§Ùƒ) Ù‡Ùˆ 13 Ø³Ù†Ø© (Ø§Ù„Ù…Ø§Ø¯Ø© 125).', 
                ref: 'ØµÙØ­Ø© 29' 
            },
            { 
                cat: 'tort', 
                q: 'Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ø§Ù„Ù…ØªØ¨ÙˆØ¹ Ø¹Ù† Ø£Ø¹Ù…Ø§Ù„ ØªØ§Ø¨Ø¹Ù‡ ØªÙ‚ÙˆÙ… Ø¹Ù„Ù‰ Ø®Ø·Ø£ Ù…ÙØªØ±Ø¶.', 
                isCorrect: false, 
                expl: 'Ù‡ÙŠ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© ØªØ¨Ø¹ÙŠØ© Ø¨Ø­ÙƒÙ… Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ØŒ Ù„Ø§ ØªØ¯ÙØ¹ Ø¨Ù†ÙÙŠ Ø§Ù„Ø®Ø·Ø£ Ø¨Ù„ Ø¨Ù†ÙÙŠ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø§Ù„Ø³Ø¨Ø¨ÙŠØ© ÙÙ‚Ø·.', 
                ref: 'ØµÙØ­Ø© 39' 
            },
            { 
                cat: 'tort', 
                q: 'ÙŠØ­Ù‚ Ù„Ù„Ù…ØªØ¨ÙˆØ¹ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¹Ù„Ù‰ ØªØ§Ø¨Ø¹Ù‡ Ø¨Ù…Ø§ Ø¯ÙØ¹Ù‡ Ù…Ù† ØªØ¹ÙˆÙŠØ¶ Ø¥Ø°Ø§ Ø§Ø±ØªÙƒØ¨ Ø§Ù„ØªØ§Ø¨Ø¹ Ø®Ø·Ø£Ù‹ Ø¬Ø³ÙŠÙ…Ø§Ù‹.', 
                isCorrect: true, 
                expl: 'Ø§Ù„Ù…Ø§Ø¯Ø© 137 (Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©) Ù‚ÙŠØ¯Øª Ø±Ø¬ÙˆØ¹ Ø§Ù„Ù…ØªØ¨ÙˆØ¹ Ø¨Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ø¬Ø³ÙŠÙ… Ù„Ù„ØªØ§Ø¨Ø¹.', 
                ref: 'ØµÙØ­Ø© 40' 
            },
             { 
                cat: 'tort', 
                q: 'Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© Ù…ØªÙˆÙ„ÙŠ Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© ÙŠÙ…ÙƒÙ† Ø¯ÙØ¹Ù‡Ø§ Ø¨Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ù‚ÙŠØ§Ù… Ø¨ÙˆØ§Ø¬Ø¨ Ø§Ù„Ø±Ù‚Ø§Ø¨Ø©.', 
                isCorrect: true, 
                expl: 'Ù„Ø£Ù†Ù‡Ø§ ØªÙ‚ÙˆÙ… Ø¹Ù„Ù‰ Ø£Ø³Ø§Ø³ Ø®Ø·Ø£ Ù…ÙØªØ±Ø¶ Ù‚Ø§Ø¨Ù„ Ù„Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¹ÙƒØ³.', 
                ref: 'ØµÙØ­Ø© 37' 
            }
        ];

        // ==========================================
        // 2. EXAM ENGINE (Logic Layer)
        // ==========================================
        const examEngine = {
            questions: [],
            currentIndex: 0,
            score: 0,
            stats: {}, // To track performance by category
            timer: null,

            // Fisher-Yates Shuffle for true randomness
            shuffle: (array) => {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            },

            start: () => {
                // Prepare Analytics
                examEngine.stats = {
                    consent: { total: 0, correct: 0 },
                    vices: { total: 0, correct: 0 },
                    pillars: { total: 0, correct: 0 },
                    effects: { total: 0, correct: 0 },
                    tort: { total: 0, correct: 0 }
                };

                // Select 15 random questions
                examEngine.questions = examEngine.shuffle([...db]).slice(0, 15);
                examEngine.currentIndex = 0;
                examEngine.score = 0;

                // UI Updates
                document.getElementById('examStart').style.display = 'none';
                document.getElementById('examActive').style.display = 'block';
                document.getElementById('examResult').style.display = 'none';
                
                examEngine.renderQuestion();
                examEngine.startTimer();
            },

            renderQuestion: () => {
                const q = examEngine.questions[examEngine.currentIndex];
                document.getElementById('qText').innerText = q.q;
                document.getElementById('qProgress').innerText = `${examEngine.currentIndex + 1} / 15`;
                document.getElementById('qCategory').innerText = `Ø§Ù„ØªØµÙ†ÙŠÙ: ${categories[q.cat]}`;
                
                // Reset UI state
                document.getElementById('feedbackBox').style.display = 'none';
                document.getElementById('nextBtn').style.display = 'none';
                const opts = document.querySelectorAll('.opt-btn');
                opts.forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('correct', 'wrong');
                    btn.style.opacity = '1';
                });
            },

            answer: (userChoice) => {
                const q = examEngine.questions[examEngine.currentIndex];
                const isCorrect = (userChoice === q.isCorrect); // The robust logic!

                // Update Stats
                examEngine.stats[q.cat].total++;
                if (isCorrect) {
                    examEngine.score++;
                    examEngine.stats[q.cat].correct++;
                }

                // UI Feedback
                const feedback = document.getElementById('feedbackBox');
                feedback.style.display = 'block';
                feedback.className = isCorrect ? 'feedback success' : 'feedback error';
                feedback.innerHTML = `
                    <strong>${isCorrect ? 'Ø£Ø­Ø³Ù†Øª! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©.' : 'Ù„Ù„Ø£Ø³Ù Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©.'}</strong><br>
                    ${q.expl} <span style="font-size:0.8rem">(${q.ref})</span>
                `;

                // Lock buttons
                document.querySelectorAll('.opt-btn').forEach(btn => btn.disabled = true);
                document.getElementById('nextBtn').style.display = 'block';
            },

            next: () => {
                examEngine.currentIndex++;
                if (examEngine.currentIndex < examEngine.questions.length) {
                    examEngine.renderQuestion();
                } else {
                    examEngine.finish();
                }
            },

            finish: () => {
                clearInterval(examEngine.timer);
                document.getElementById('examActive').style.display = 'none';
                document.getElementById('examResult').style.display = 'block';

                const percentage = Math.round((examEngine.score / 15) * 100);
                document.getElementById('finalScore').innerText = `${percentage}%`;

                // Generate Smart Analytics HTML
                let analyticsHTML = '';
                for (const [key, val] of Object.entries(examEngine.stats)) {
                    if (val.total > 0) {
                        const catScore = Math.round((val.correct / val.total) * 100);
                        let color = catScore > 70 ? 'var(--success)' : (catScore < 50 ? 'var(--error)' : 'var(--accent)');
                        
                        analyticsHTML += `
                            <div class="stat-card" style="border-right-color:${color}">
                                <div class="stat-label">${categories[key]}</div>
                                <div class="stat-val" style="color:${color}">${catScore}%</div>
                                <div style="font-size:0.8rem; opacity:0.7">(${val.correct}/${val.total})</div>
                            </div>
                        `;
                    }
                }
                document.getElementById('analyticsBox').innerHTML = analyticsHTML;

                // Message
                const msg = percentage >= 60 ? "Ø£Ø¯Ø§Ø¡ Ø¬ÙŠØ¯ØŒ Ø§Ù†Ø¸Ø± Ù„Ù„ØªØ­Ù„ÙŠÙ„ Ù„Ù…Ø¹Ø±ÙØ© Ù†Ù‚Ø§Ø· Ø§Ù„Ø¶Ø¹Ù." : "ØªØ­ØªØ§Ø¬ Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ù…ÙƒØ«ÙØ© Ù„Ù„Ù…Ø­Ø§ÙˆØ± Ø°Ø§Øª Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø©.";
                document.getElementById('finalMsg').innerText = msg;
            },

            startTimer: () => {
                let sec = 0;
                const el = document.getElementById('timer');
                clearInterval(examEngine.timer);
                examEngine.timer = setInterval(() => {
                    sec++;
                    const m = Math.floor(sec / 60).toString().padStart(2,'0');
                    const s = (sec % 60).toString().padStart(2,'0');
                    el.innerText = `${m}:${s}`;
                }, 1000);
            }
        };

        // ==========================================
        // 3. UI HANDLING
        // ==========================================
        function setMode(mode) {
            document.querySelectorAll('.btn-outline').forEach(b => b.classList.remove('active'));
            document.getElementById(mode === 'review' ? 'btnReview' : 'btnExam').classList.add('active');
            
            if (mode === 'review') {
                document.getElementById('reviewSection').style.display = 'block';
                document.getElementById('examSection').style.display = 'none';
                renderReview();
            } else {
                document.getElementById('reviewSection').style.display = 'none';
                document.getElementById('examSection').style.display = 'block';
                document.getElementById('examStart').style.display = 'block';
                document.getElementById('examActive').style.display = 'none';
                document.getElementById('examResult').style.display = 'none';
            }
        }

        function renderReview(term = '') {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';
            
            const filtered = db.filter(i => i.q.includes(term) || i.expl.includes(term));
            
            if (filtered.length === 0) {
                container.innerHTML = '<div style="padding:20px; text-align:center; color:#94a3b8">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>';
                return;
            }

            filtered.forEach(item => {
                const div = document.createElement('div');
                div.className = 'q-item';
                div.innerHTML = `
                    <div class="q-head" onclick="this.parentElement.classList.toggle('open')">
                        <div>${item.q} <span class="cat-tag">${categories[item.cat]}</span></div>
                        <span>â–¼</span>
                    </div>
                    <div class="q-body">
                        <div style="font-weight:bold; color:${item.isCorrect ? 'var(--success)' : 'var(--error)'}; margin-bottom:5px;">
                            ${item.isCorrect ? 'âœ… ØµØ­ÙŠØ­' : 'âŒ Ø®Ø·Ø£'}
                        </div>
                        ${item.expl} <br>
                        <span style="font-size:0.8rem; color:#94a3b8">Ø§Ù„Ù…ØµØ¯Ø±: ${item.ref}</span>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            renderReview();
            
            // Search Listener
            document.getElementById('searchInput').addEventListener('input', (e) => {
                renderReview(e.target.value);
            });

            // Countdown
            const examDate = new Date('2026-01-11T10:00:00').getTime();
            setInterval(() => {
                const diff = examDate - new Date().getTime();
                if (diff < 0) return;
                const d = Math.floor(diff / (1000 * 60 * 60 * 24));
                const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                document.getElementById('countdown').innerHTML = `
                    <div class="time-unit"><span class="time-val">${d}</span><span class="time-lbl">ÙŠÙˆÙ…</span></div>
                    <div class="time-unit"><span class="time-val">${h}</span><span class="time-lbl">Ø³Ø§Ø¹Ø©</span></div>
                `;
            }, 1000);
        });
    </script>
</body>
</html>
